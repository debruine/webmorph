[["index.html", "WebMorph Manual Overview 0.1 Bugs and Suggestions 0.2 Citations", " WebMorph Manual Lisa DeBruine 2021-02-26 Overview WebMorph is a web-based version of Psychomorph, with several additional functions. While WebMorph is optimized for averaging and transforming faces, you can delineate and average any type of image. WebMorph also has several batch functions for processing large numbers of images automatically and can even create moving gifs of your transforms. WebMorph is made possible by the kind help of Bernie Tiddeman, who developed and maintains the desktop version of Psychomorph. WebMorph uses the open-source Java library FaceMorphLib and is developed and maintained by Lisa DeBruine. Much of the development of WebMorph, especially the 3D functions, was funded by ERC grant #647910 KINSHIP. WebMorph is currently in beta testing and is likely to remain so for some time. This means that there will be bugs and you cannot rely on the website being functional 100% of the time. Lisa will try to fix any problems as fast as possible, but she is the only person working on this project, so please be patient. If you’re curious about the code or want to help with development, this project is open source at GitHub. 0.1 Bugs and Suggestions If you spot any errors in WebMorph or this manual, or have a suggestion, please add it to the list of issues. 0.2 Citations Lisa DeBruine. (2018). Webmorph (Beta Release 2). Zenodo. doi: 10.5281/zenodo.1073696 To cite the morphing and transforming methods, see Bernie Tiddeman’s webpage. The symmetric image scrambling methods were first published in Conway et al. (2008). The built-in image sets (DeBruine and Jones 2017) are available with a CC-BY 4.0 license. "],["getting-started.html", "Chapter 1 Getting Started 1.1 Accounts 1.2 Projects 1.3 Finder 1.4 Delineate 1.5 Average 1.6 Transform", " Chapter 1 Getting Started 1.1 Accounts 1.1.1 Academic Accounts If you have an academic email address, you should be able to sign up for a free account and be authorised automatically. If your email isn’t automatically recognised as academic, email Lisa and ask to be authorised. You will receive your password in an email (check the spam folder if it doesn’t arrive in a few minutes). These accounts have 265 MB of permanent storage. Contact Lisa if you really need more, but you can always download your files and re-upload them later. 1.1.2 Waitlist There is a currently a waitlist for non-academics. The reason is that letting anyone who wants an account have one would overwhelm the system. We don’t currently have any funding, but am to apply for some and expand our capacity as soon as possible. 1.1.3 Guest Accounts Anyone can access a guest account. These accounts have limited temporary storage (128 MB) and no permanent storage. You need to download any files you want to keep before you log out. 1.1.4 Log in Once you have your password, log in from the main website page. This web application is a single-page app (which has some advantages for using it on a tablet), but emulates a multi-page app using “fragment identifiers.” For example, you can access a file called “f_multi.jpg” in the folder called “composites” in the Finder interface for project 1 at “https://webmorph.org/#F1/composites/f_multi.jpg” (or you could if you were logged in a someone with permission to access that project) 1.2 Projects When you first log in, you are taken to the Projects page (6). This page will show all your projects and an overview of their storage and your total allocation. 1.2.1 New Project Choose New Project (N) from the File menu. Then enter the project name and a description. Double-click on a project name or description in the project list to edit it. 1.2.2 Project Users Click on the last column to add or delete users. Start typing a name or email address and wait for the auto-complete to show you a list of matching users. Select the user you want to add and press Enter. The list will reload and then you can click on the last column to check they have been added. An “A” next to the name means they have all permissions to add, delete, and change files. Click on the “A” to change it to “R” for read-only permissions. Click on the “-” to remove this user. Adding users to your project doesn’t affect their allocation and you can’t remove yourself from a project. Click on Go to load your first project. 1.3 Finder Projects open in the Finder interface, which is a file navigation interface like the Mac OS Finder or Windows Explorer. Click on the folders and files to navigate like you would in the Finder on your computer. You can also navigate with the arrow keys. If the finder interface starts to look weird or isn’t updating the way you think it should, that’s probably a bug. Choose Refresh (R) under the View menu to reload the Finder. New projects come with two folders: composites and templates. You can also see the Trash (which you can hide under the View menu). Click on the composites folder and select an image. You should see some file information, including the image dimensions, the date the file was created, and whether it has an embedded template. Figure 1.1: Finder window If you click on a template file (e.g., “f_multi.tem”) you will see similar file information, as well as a small window with the template text. You will probably not ever need to work with these numbers directly, but they are human-readable. You can upload text files (.txt) to WebMorph for your own records. Their text also displays in the small window if you click on them, but you can’t edit them in WebMorph. The “templates” folder contains tab-separated text files that are used for batch processing. 1.3.1 Built-in Image Sets WebMorph provides a few open source (CC-BY) image sets for you to use. They are available at FigShare, but also directly through the webmorph interface. London Face Set (Composites) (DeBruine 2016) is the same as the composites directory that every new project has. London Face Set (Neutral) (DeBruine and Jones 2017) is images of 102 adult faces with a neutral expression plus templates. London Face Set (Smiling) (DeBruine and Jones 2017) is the same 102 faces with smiling expressions. There are no templates. 3D are composite images of male and female East Asian and White young adult faces. These can be used to demonstrate the new 3D functions. Navigate to the place where you want to add the image set and choose the set from Built-In Image Sets in the File menu. Copying the files over can take up to 30 seconds, so be patient (I’m working on fixing this). 1.3.2 Adding Folders and Files Create a new folder in the base of your project by clicking underneath all of the folder names to close nay open folders. Then choose New Folder (N) from the File menu. Type the new folder name into the pop-up window and click Save. Add files from your computer by choosing Upload (U) from the File menu. You can select multiple files, but not folders to upload. You cannot upload from a zip file yet. 1.3.3 Uploading from Webcam You can also upload images from a webcam (U). This will bring up a window with the image from your webcam (you may need to give webmorph access first through some permissions pop-ups). Line up your face approximately with the superimposed template and press return to capture the image. Type in a file name and click Save to save it. 1.3.4 Deleting Files Select a folder or files (click or click to select multiple files) and choose Move to Trash (delete) from the File menu. delete skips the confirmation dialog. 1.3.5 Moving Files The best way to move files is to cut (X) or copy (C) and paste (V) selected files. You can drag files into another folder, but this can be buggy and I might remove it soon. 1.3.6 Renaming Files Select a file or folder and press Enter, edit the name, and press Enter to accept the new name (or click outside the file to cancel). If you change an image file’s name, its associated template file name will also change. 1.4 Delineate Double-click on an image or template file to open it in the delineation window. The delineation toolbar should be visible. If it’s not, choose Delineation Toolbar in the View menu. The question mark button in the toolbar shows a pop-up of helpful hints. 1.4.1 Fit Template If an image file does not have an associated template, you will be prompted to 3-point delineate it. A prompt will show in the delineation toolbar to remind you where to click (usually left eye, right eye, and centre of the bottom of the upper lip). If you mess this up, just repeat it by choosing Fit Template (F) from the Template menu. 1.4.2 Change Size You may want to change the size of the image first. You can do this with the buttons in the delineation toolbar or command keys. +: increase size -: decrease size 0: original size M: fit to the window 1.4.3 Auto-Delineation You can automatically delineate a face with the 83-point Face++ template by choosing Auto-Delineate (D) from the Template menu. You can auto-delineate a batch of images by selecting them in the Finder and doing the same. Don’t auto-delineate image that already have template. Delete those files first. If any images in a batch fail (check the Queue menu item), this might be because Face++ is limiting the number of concurrent sessions. Just try to auto-delineate those images again in a minute or two. 1.4.4 Delineation Click on each point and drag it to fit the template to the face. The point number, label, x and y coordinate are shown in the bottom left of the window when you move points. The name of the image is in the bottom right. Figure 1.2: Delineation window. Drag each point to delineate the shape of the image. click on a point to select or unselect it. click or click on a point to select or unselect the whole line. Hold shift and drag over the image select all points inside the box. Move a group of selected points by moving any selected point with the mouse or using the arrow keys. + and - to increase or decrease the size of a selected group of delineation points. ← and → to rotate a selected group of delineation points. A (or double-click on the image) to unselect all points. 1.4.5 Save Template Choose Save (S) from the File menu to save the template. It will automatically save with the same name as the associated image. If you want to scroll through a folder of images, click the Next image (fast forward) button on the delineation toolbar (→). 1.4.6 Size and Normalisation The size of the average will be taken from the first image in the average list. If images are different sizes, you may want to change the default normalisation (under Preferences (,) Images) from “None” to “2-point” or “Rigid-body.” None: averages will have all coordinates as the exact mathematical average of the coordinates in the component templates 2-point: all images are first aligned to the 2 alignment points designated in the Default alignment preference. Their position is set to their position in the first image in the average Rigid-body: procrustes aligns all images to the position of the first image in the average list 1.5 Average Once you have a few images delineated, you’re ready to make an average. Select Average (4) under the Window menu. Figure 1.3: Average window. In this window, only images with associated template files are visible. You can select multiple images, or , if your images are in different folders or you want to include an image more than once (e.g., and average that is 2/3 face A and 1/3 face B), you can drag the images to the average box to add them. Select a listed image and click the delete button to remove it. Once your images are selected, click the Average button to create a composite image. The bottom status feed will give you an indicative amount of time this will take, but actual times can be shorter or longer depending on server load. 1.5.1 Texture By default, WebMorph averages are made with texture on. You can change this default in the Images tab of the Preferences (,). Figure 1.4: An average of 5 faces. The image on the left has texture on; the image on the right has texture off. This applies a representative texture to the average, resulting in composite images with more realistic texture instead of the very smooth, bland texture most other averaging programs create. See the papers below for methodological details. B. Tiddeman, M. Stirrat and D. Perrett (2005). Towards realism in facial prototyping: results of a wavelet MRF method. Theory and Practice of Computer Graphics. B. Tiddeman, D.M. Burt and D. Perrett (2001). Computer Graphics in Facial Perception Research. IEEE Computer Graphics and Applications, 21(5), 42-50. 1.5.2 Sample Contours By default, WebMorph averages are made with sample contours on. You can change this default in the Images tab of the Preferences (,). This interpolates more control points along the lines. This can improve the accuracy of averages and transforms. If you see a ‘feathery’ appearance along lines that have many, close-together points, try turning this off. 1.5.3 Saving Averages Click on the folder you want to save the image into and then click the Save button. Add the image name after the folder path. If you add an image extension (.jpg, .png, or .gif) it will be saved as that file type. If you omit the extension, it will be set to your default extension. You can change this default in the Images tab of the Preferences (,). You can try out a few averages before you decide which to save. Averages go in the Recently Created Images box where you can click on them to reload them in the average box and save them. 1.6 Transform Now that you have some averages, you can use the to transform images. Select Transform (5) under the Window menu. Figure 1.5: Transform window. The transform interface requires three images: the image to transform, the negative end of the transform dimension, and the positive end of the transform dimension. For example, if you want to alter the sexual dimorphism of an individual’s face shape, you would load the individual face in the image to transform box, an average female face in the left transform dimension box, and an average male face in the right transform box. We usually try to keep all other demographic and visual aspects of the transform dimension faces the same as the face to transform, as far as possible. Here, we use composite images that are the same (broad) ethnic group as the individual face. They are also young adults and have front-facing, neutral expressions. Add image to the boxes by dragging the image, or selecting and image in the Finder and double-clicking the box it should go into in the transform interface. Choose the percentage of shape, colour, and texture to transform. For example, 100% adds 100% of the difference between the negative and positive transform dimension images to the individual image, while -50% subtracts 50% of that difference. Remember, transforming adds or subtracts a percentage of the difference between the transform dimension images to the base image. A 100% transform will not make the base image look exactly like the right transform image. You can set shape or colour to 0% to do a colour-only or shape-only transform. Much of the published research on perceptions of masculine and feminine faces uses 50% shape-only transformations like the example above. 1.6.1 Transform Multiple Images If you load images into the transform dimension boxes and select more than one image in the Finder, the Transform button changes to Transform All. This sets up a batch file, which will apply this transform to all the selected images. 1.6.2 Continuum You can make a continuum, such as transforming from one person to another, using the continuum settings. Set the start and end percentages for shape, colour and texture; the number of steps in your continuum, and the file name to save the images to. Each step will have numbers appended to it. Figure 1.6: Continuum interface. After you click Transform, the individual frames are sent to the Queue and will appear in the Finder as they are created. "],["batch-processes.html", "Chapter 2 Batch Processes 2.1 Batch Functions 2.2 Batch Files 2.3 Other Functions", " Chapter 2 Batch Processes 2.1 Batch Functions Select multiple images in the Finder and use the functions under the Batch menu to apply transformations to all of the selected images. The individual processes will be added to the Queue and complete in the background. I am writing an R package to do much of this on your own computer, which can often be faster than the webmorph server. 2.1.1 Rename Replace text, add a prefix or suffix, or add an index to selected images. Figure 2.1: Batch Rename. 2.1.2 Align Align delineated images on two points. This rotates and resizes images so that the specified points are all in the same place (usually the pupils). The default values for the alignment come from Preferences, but you can change them. If the alignment makes an image smaller than the image size, the background will be the specified colour. Figure 2.2: Batch Align. 2.1.3 Crop Crop an image by specifying the number of pixels to add or remove from each side. You can select the background colour for added pixels from the average of a patch of the image whose coordinates you specify (defaulting to the top left 10 pixel square). Figure 2.3: Batch Crop. 2.1.4 Mask Masking allows you to use the delineation lines to mask off areas of an image. There are several masks built into WebMorph that work with the FRL-Face template, but you can define your own. Figure 2.4: Batch Mask. You can combine masks. The interface will let you visualise what each mask is. Reversing a mask puts the colour inside the mask instead of outside (although the masking interface still shows an external mask, sorry). If you set the mask to transparent, the masked images will be PNGs with transparency. The blur function doesn’t work as well as PsychMorph’s and you usually can’t tell the difference with images that are large. You can create a custom mask by unselecting all of the built-in masks and directly typing the points to use in the text box that appears. For example, with the custom 10-point template “outline”, you can mask the face with this: 0,1,2,3,4,5,6,7,8,9,0. Notice how the first point is also appended to the end. If you don’t do this, masks will have a jagged corner. Figure 2.5: Custom Masks. The image on the left didn’t include the starting point at the end. You can build a mask by clicking on the delineation points you want to add in the Template interface. Load an image with the correct template and choose Custom Mask Builder from the Template menu. Click on points to add them to the text box. Separate points with commas, lines with semicolons, and mask areas with colons. You can’t get out of the Custom Mask Builder interface. Until I fix it, just reload the page to get out. For example, this will create one mask that masks the pupils, as the points 2-9 delineate the left pupil and points 10-17 delineate the right pupil. Reverse the mask to replace the pupils with the mask colour. 2,3,4,5,6,7,8,9,2 : 10,17,16,15,14,13,12,11,10 2.1.5 Mirror Batch mirror mirror-reverses the images and their templates. Templates need to have their symmetry points defined in order to do this. Most of the built-in templates in WebMorph have this, but you will need to do this yourself for any custom templates. For example, in the FRL-Face template, point 0 is the left pupil and point 1 is the right pupil, so in the mirror-reversed version, the x-coordinates are all flipped and the identities of matching points are swapped so that the pupil point on the left side of the image is 0 in both original and mirror-reversed versions. This is the first step to creating a symmetric face. 2.1.6 Resize Resize images by percent or pixel. If you only enter one of width or height, the other dimension is scaled to the same aspect ratio as the original image. You will see a table of the original and new dimensions to check before you click Resize. Figure 2.6: Batch Resize 2.1.7 Rotate Set the number of degrees to rotate (e.g. 90 degrees rotates the images one-quarter of a turn clockwise). If your rotated image is squint, you need to set a background colour to fill in the triangles in the edges. If you choose “Select color from patch,” each image’s background will be taken from the average of the specified pixels. Figure 2.7: Batch Rotate 45 degrees with Select color from patch 2.1.8 Scramble Some vision research uses scrambled images as controls. They will have the same distribution of colour as the unscrambled image, but scrambling introduces horizontal and vertical structure that isn’t present in the original image, so we recommend to place grid lines on both the original and scrambled images. Scramble an image by choosing the grid size and offset, then select/unselect the squares to scramble by clicking or dragging on the image. If your selected squares are symmetric, you can choose a symmetric scramble, where the squares on the left side are scrambled, and the squares on the right side are in a mirrored pattern. This looks pretty creepy, but maintains the bilateral symmetry of the original image in the scrambled version. Each face in a set is scrambled Figure 2.8: Batch Scramble The symmetric image scrambling methods were first published in Conway et al. (2008), so please do cite that paper if you use this method. You can scramble only inside a masked area, although this is experimental and sometimes is glitchy. Set the grid size fairly small and turn off grid lines to create a pixelated look. Figure 2.9: Batch Scramble inside a mask. 2.1.9 Symmetrise You can symmetrise an image in shape, color, or both. Just like batch mirroring, templates need to have their symmetry points defined in order to do this. Most of the built-in templates in WebMorph have this, but you will need to do this yourself for any custom templates. Figure 2.10: Batch Symmetrise. Original image, symmetric shape, symmetric colour, and both. 2.2 Batch Files WebMorph has three types of batch files that let you process many images programmatically. 2.2.1 Batch Average Batch Average Template Put the name of each average on the first row and the images in the average in the rows below. Put each average in a new column. In the example below, the first average is made from two images (m_multi and f_multi) and will be saved in a folder called avg_test as androgynous.jpg. The second example will be made from 4 images, 3 of which are the same (so will be 1/4 f_multi and 3/4 m_multi). /avg_test/androgynous.jpg /avg_test/3male1female.jpg /composites/m_multi.jpg /composites/f_multi.jpg /composites/f_multi.jpg /composites/m_multi.jpg /composites/m_multi.jpg /composites/m_multi.jpg 2.2.2 Batch Transform Batch Transform Template trans-img from-img to-img shape color texture outname /composites/f_multi.jpg /composites/m_multi.jpg /composites/f_multi.jpg 50 0 0 /trans_test/female_fem50.jpg /composites/f_multi.jpg /composites/m_multi.jpg /composites/f_multi.jpg -50 0 0 /trans_test/female_masc50.jpg /composites/m_multi.jpg /composites/m_multi.jpg /composites/f_multi.jpg 50 0 0 /trans_test/male_fem50.jpg /composites/m_multi.jpg /composites/m_multi.jpg /composites/f_multi.jpg -50 0 0 /trans_test/male_masc50.jpg /composites/f_white.jpg /composites/f_multi.jpg /composites/f_white.jpg 25% 25% 25% /trans_test/f_wh_caric.jpg 2.2.3 Batch Edit Batch Edit Template The batch edit function lets you align, resize, rotate, crop, mask, symmetrise, and/or mirror images in any order. Every row must have a valid image name of an image that exists in your project, and a valid outname that can’t overwrite an existing image. image: The path to the image file: e.g., /male/avg.jpg align: pt1, pt2, x1, y1, x2, y2, width, height, [color] e.g., 0,1,497,825,853,825,1350,1800,rgb(0,0,0) or DEFAULT resize: width, height e.g., 50%,50% or 300px,400px or null,400px rotate: degrees, [color] e.g., 90,rgb(255,255,255) crop: top, right, bottom, left, [color] e.g., -100,100,-100,100,rgb(0,0,0) mask: (mask names or custom mask), blur, [color] e.g., (face,neck,ears),0,rgb(255,255,255) or (face),10,transparent sym: shape and/or color mirror: true or leave blank order: defaults to align,resize,rotate,crop,mask,sym,mirror outname: The path to save the result to: e.g., /male/edited/avg.jpg The file needs all 10 columns with their headers, but I’ll show each batch function below with only the relevant columns. 2.2.3.1 Align Align using your default alignment (DEFAULT), the default FRL-face alignment (FRL), or the specified alignment in the order point 1, point 2, x1, y1, x2, y2, width, height. image align outname /composites/f_multi.jpg DEFAULT /edit_test/align_default.jpg /composites/f_easian.jpg FRL /edit_test/align_frl.jpg /composites/f_african.jpg 0,1,200,300,400,300,600,600 /edit_test/align_square.jpg 2.2.3.2 Resize Resize images with a single percentage, or width and height as pixels or percentages. To omit width or height, use null. image resize outname /composites/f_white.jpg 50% /edit_test/resize_50_percent.jpg /composites/f_wasian.jpg null,400px /edit_test/resize_400px_tall.jpg /composites/m_multi.jpg 200px,200px /edit_test/resize_200x200px.jpg /composites/m_easian.jpg 300px,null /edit_test/resize_300px_wide.jpg /composites/m_african.jpg 50%,25% /edit_test/resize_50x25_percent.jpg 2.2.3.3 Rotate Rotate images with the degrees to rotate. If you need to set a non-default background color, add this after the rotation value in the format rgb(r, g, b). image rotate outname /composites/m_white.jpg 90 /edit_test/rotate_90.jpg /composites/m_wasian.jpg 45,rgb(255,0,0) /edit_test/rotate_45red.jpg /composites/f_multi.jpg -90 /edit_test/rotate_neg90.jpg 2.2.3.4 Crop Crop images by setting the top, right, bottom and left pixels. Set a non-default background color in the format rgb(r, g, b). image crop outname /composites/f_multi.jpg -300,0,-300,0 /edit_test/crop_short.jpg /composites/f_multi.jpg 100,100,100,100,rgb(0,255,0) /edit_test/crop_green_border.jpg 2.2.3.5 Mask Put the mask names inside parentheses (comma-delimited), then the blur level (0-10), and an optional background color in the format rgb(r, g, b). image mask outname /composites/f_multi.jpg (face),10,rgb(255,0,0) /edit_test/mask_red.jpg /composites/f_multi.jpg (face),0,rgb(0,255,0) /edit_test/mask_green.jpg /composites/f_multi.jpg (face,neck,ears),0 /edit_test/mask_face_neck_ears.jpg /composites/f_multi.jpg (neck),0 /edit_test/mask_neck.jpg /composites/f_multi.jpg (left_eye),0 /edit_test/mask_left_eye.jpg /composites/f_multi.jpg (right_eye),0 /edit_test/mask_right_eye.jpg /composites/f_multi.jpg (eyes),0 /edit_test/mask_eyes.jpg /composites/f_multi.jpg (left_brow),0 /edit_test/mask_left_brow.jpg /composites/f_multi.jpg (right_brow),0 /edit_test/mask_right_brow.jpg /composites/f_multi.jpg (brows),0 /edit_test/mask_brows.jpg /composites/f_multi.jpg (left_ear),0 /edit_test/mask_left_ear.jpg /composites/f_multi.jpg (right_ear),0 /edit_test/mask_right_ear.jpg /composites/f_multi.jpg (ears),0 /edit_test/mask_ears.jpg /composites/f_multi.jpg (nose),0 /edit_test/mask_nose.jpg /composites/f_multi.jpg (mouth),0 /edit_test/mask_mouth.jpg 2.2.3.6 Sym Symmetrise with shape and/or color, separated by a comma. image sym outname /composites/f_multi.jpg shape,color /edit_test/sym_shape_color.jpg /composites/f_multi.jpg shape /edit_test/sym_shape.jpg /composites/f_multi.jpg color /edit_test/sym_color.jpg 2.2.3.7 Mirror Mirror with TRUE, FALSE, or leave blank. image mirror outname /composites/f_multi.jpg TRUE /edit_test/mirror.jpg 2.2.3.8 Multiple You can apply several edits to a single image in one step. image align resize rotate crop mask sym mirror order outname /composites/f_multi.jpg FRL 50% 90 10,10,10,10,rgb(255,0,0) (face),0,rgb(255,255,255) shape,color FALSE /edit_test/multi_1a.jpg /composites/f_multi.jpg FRL 50% 90 10,10,10,10,rgb(255,0,0) (face),0,rgb(255,255,255) shape,color FALSE align,resize,rotate,crop,mask,sym /edit_test/multi_1b.jpg /composites/f_multi.jpg FRL 50% 90 10,10,10,10,rgb(255,0,0) (face),0,rgb(255,255,255) shape,color FALSE resize,rotate,crop,mask,sym,align /edit_test/multi_2.jpg /composites/f_multi.jpg FRL 50% 90 10,10,10,10,rgb(255,0,0) (face),0,rgb(255,255,255) shape,color FALSE crop,resize,sym,align /edit_test/multi_3.jpg /composites/f_multi.jpg 0,1,200,300,400,300,600,600 50% 90 10,10,10,10,rgb(255,0,0) (face),0,rgb(255,255,255) shape,color FALSE crop /edit_test/multi_4.jpg /composites/f_multi.jpg 0,1,200,300,400,300,600,600 50% 90 10,10,10,10,rgb(255,0,0) (face),0,rgb(255,255,255) shape,color FALSE crop,crop /edit_test/multi_5.jpg 2.3 Other Functions 2.3.1 Calculate FacialMetrics Use the x and y coordinates of templates to calculate facial metrics. There are two built-in metrics: FWH: face width-to height ratio, face height is the distance between the upper lip and the highest point of the eyelids, face width is the maximum distance between the left and right facial boundary (i.e., bizygomatic width) (following Lefevre et al. 2013) abs(max(x[113],x[112],x[114])-min(x[110],x[111],x[109]))/abs(y[90]-min(y[20],y[25])) Eye-spacing: the distance between the centres of the pupils (this isn’t very useful, but mainly there to remind you of the equation for the distance between two points) sqrt(pow(x[0]-x[1], 2) + pow(y[0]-y[1],2)) Click calculate after choosing a metric to add its calculation to a table for downloading. You can also write your own equations. refer to points by their number, e.g., x[0] or y[1]. You can find the point numbers by hovering over them in the Delineate window. Allowed functions in equations are: abs, min, max, tan, sin, cos, atan, asin, acos, sqrt, pow and rad2deg. Units are in pixels. The origin (0,0) is in the upper left corner. Max and min values of template points can be useful for knowing how much you can crop a set of images without going into the templates. Here are the relevant points for the FRL-Face template. Top: y of the highest halo point, y[151] Bottom: minimum y of the adams apple points, max(y[183], y[184]) Left: x of left halo point outside the ear, x[147] Right: x of right halo point outside the ear, x[155] If you’re using the Hand template, you can calculate 2D4D (the ratio of the second to fourth digit) with the following equation: sqrt(pow(x[2]-x[3], 2) + pow(y[2]-y[3],2)) / sqrt(pow(x[6]-x[7], 2) + pow(y[6]-y[7],2)) For anything more complicated, it’s probably better to download all the x and y coordinates and process them yourself. There is a button for getting all the coordinates from a set of templates into one spreadsheet. 2.3.2 Lab* Pixels Create CSV files with CIELAB color values for each pixel. Check ‘ignore mask’ to omit pixel values that are the same as the top left pixel color. A CSV file will be created for each image with columns x, y, L , a, and b, with the x and y-coordinates of each pixel and their L*, a* and b* colour values. Table 2.1: Example rows from an Lab colour file. x y L a b 96 80 90.0460 -64.7454 54.8329 96 83 90.1418 -63.9054 53.6131 96 84 90.1522 -63.9010 54.5343 96 85 90.1522 -63.9010 54.5343 96 86 90.1522 -63.9010 54.5343 96 87 89.8794 -63.2933 53.3068 96 89 90.0148 -64.9838 54.7882 96 90 90.0041 -65.1015 55.2222 96 91 90.0148 -64.9838 54.7882 2.3.3 Image Grid Make a 2-dimensional grid of images. Figure 2.11: Image Grid. 2.3.4 Multiple Continua Create multiple morphing continua. Figure 2.12: Multiple Continua. 2.3.5 Moving Gif Select a set of images, such as a multiple continuum, choose Moving Gif from the Batch menu, and create an animated image. "],["templates.html", "Chapter 3 Templates 3.1 Change Default Template 3.2 Delneation 3.3 Batch Template Functions 3.4 New Templates", " Chapter 3 Templates 3.1 Change Default Template The template used for new templates will be your default template, which starts as the 189-point FRL-face template, but you can change this in the Preferences (,). You can see your current template under Current Templates in the Templates menu. Figure 3.1: Current template and other options. One unusual template is for hands. You fit the hand template by clicking in the base of the second digit, the tip of the third digit, and the base of the fourth digit. You can use this to calculate 2D4D for scanned hand images. I’m not sure this line of research means much, but this is a tool that can do it if you must. Figure 3.2: Hand Template. Don’t measure hands like this; use a flatbed scanner. Or just don’t do 2D4D research. 3.2 Delneation 3.2.1 Close Mouth In the FRL-Face template, the bottom of the top lip is a red line, while the to of the bottom lip is a blue line (think “blue” = “depressed”). If the face has lips together, you can just delineate the bottom blue line and choose Close Mouth (C) to move the red line exactly underneath. Figure 3.3: The red line is the bottom of the top lip. 3.3 Batch Template Functions There are several functions under the Template menu that you can apply to all selected templates. 3.3.1 Convert Templates You can convert between a few types of templates, such as FRL-Face (the default 189-point front face template) and PL-Face (a 179-point template commonly used in Dave Perret’s Perception Lab). You can convert to the auto-delineation template (Face++) but not back yet (it’s much easier to remove points from a template than add them. Figure 3.4: Tem conversion options Conversions are usually approximate, as some points are just guessed based on the placement of other points (there is no machine vision going on here), so you should always look through your converted templates and fix any inaccuracies. 3.3.2 TPS Files A TPS file is a way to represent shape data of several images in one file. These are used by geometric morphometric programs like facefuns. You can create a TPS file by selecting the templates you want to add (any non-template selected files will be ignored) and choosing Create TPS File from the Template Menu. This will save a .tps file in that folder that you can download. 3.3.3 Tem from Embedded If a JPEG image is created in webmorph, the template is embedded in the image, so you can recover it even if you deleted the template file. This information, along with the image history, is stored in the EXIF, which can be removed. All images say that “Tem Embed” is false in the image preview. This is a bug. Also, the built-in images don’t have embedded templates. I will fix this when I get time. 3.3.4 Modify Delineation You can batch delete points from selected templates. This is useful if you want to keep only the points appropriate for a geometric morphometric analysis (facefuns also has a function to do this). The lines usually get messed up when you delete points, so I just delete all the lines, which are seldom used for geometric morphometrics. 3.4 New Templates You can register a template you uploaded from another version of WebMorph or Psychomorph, or a new one you created here. Registering a template allows you to use it to delineate new images and lets you set the point names and symmetry points. 3.4.1 From a Saved Template Load the image with the template you want to register. Select the three points you want to use for 3-point delineation by shift-clicking on them. This only works if you select exactly 3 points. I recommend always setting the first three points to the centre of the left eye, centre of the right eye, and centre of the bottom of the top lip to make fitting delineation easier. Choose New/Edit Template from the Template menu Make sure that “Register this as a new template” is checked, unless you are editing one of your previously saved templates. You can’t edit the public templates that you don’t own (e.g., FRL-face, FRL-body, Face++). Give the template a useful name and notes. The 3 points for 3-point delineation will be automatically filled in from the points you selected. You can change or re-order them here. Figure 3.5: Save a new template. 3.4.2 From Scratch If you want to make a template from scratch, start with an image that has no saved template. You can fit the current template, and then delete it by clicking A to select all points and delete. This is a buggy process right now, so it might take a few tries. First, add new points using click. Use L to start drawing a new line; the cursor will change to a wand. Hover over points until they turn red (you need to move the cursor icon around a bit to find the right point) and click to add them to a line. Click ‘enter’ to end the line; it will turn from red to blue. Use L to delete a line by clicking on any point attached to the line. Figure 3.6: Editng points and lines Save your template and follow the instructions above for registering a new template. 3.4.3 Set Point Labels After you save the template, choose “Set Point Labels” from the Template menu. Each point will be selected in turn (and an arrow will point at it). Type the name into the box at the top of the screen and press return. Figure 3.7: Setting template point labels. 3.4.4 Setting Symmetry Points To set symmetry points for mirroring or symmetrising images, choose Set Symmetry Points from the Template menu. Look for the highlighted point and cmd-click on its corresponding point on the other side. You can move points out of the way to check if they are overlapping. If a point is on the midline, its corresponding point is itself. If you make a mistake, click cmd-Z to go back a point. Figure 3.8: Setting symmetry points. "],["d.html", "Chapter 4 3D", " Chapter 4 3D The 3D functions are currently under development. You can upload OBJ files and associated BMP or JPEG textures and view them in the 3D Window (3). You can also morph between two objects that have the same geometry. Figure 4.1: 3D Window. You can capture frames from moving 3D objects and create animated gifs. "],["preferences.html", "Chapter 5 Preferences 5.1 Personal 5.2 Images 5.3 Templates", " Chapter 5 Preferences 5.1 Personal We ask for your personal information to help with the development of WebMorph. This is optional, apart from a working email address, which you will need to be able to get and reset your password. We’re always happy to hear from you about what sort of things would make WebMorph better or easier to use. 5.1.1 Default Project This used to do something, but doesn’t anymore. 5.1.2 Theme Colour Set a theme color for the interface. 0 is a light neutral color scheme. Go all the way to the right for a dark color scheme (this is experimental and might be a little ugly or have inappropriate contrast). 5.2 Images 5.2.1 Show thumbnail images This shows small thumbnails in the finder. If you have many images in your project, this can slow down finder loading. 5.2.2 Default image format The image format in which to save new images. You can always change the image format in any individual Batch process dialog. JPG: This is the default, as it has relatively small file size (we use the best-quality JPEG compression of 100), so a 1350x1800 pixel image will be about 0.5 MB. JPGs can contain embedded information about the image. PNG: This is uncompressed (we use the best-quality PNG compression of 0), so a 1350x1800 pixel image will be about 7.0 MB. This file type is good for very small images or for images where exact color is important. PNGs can also use transparency, so images with transparent masks are always saved as PNGs. GIF: This is uncompressed, but images are smaller than PNGs, so a 1350x1800 pixel image will be about 1.0 MB. Transparency is possible, but not as sophisticated as in PNGs. We mainly use GIFs as the frames for animated GIFs. 5.2.3 Batch default names Folder (e.g., /sym/filename): Images created under the Batch menu are put in a new folder inside the original folder and the image names are kept the same as the originals Prefix (e.g., /sym_filename): Images created under the Batch menu are put in the original folder and the image names are given a prefix Suffix (e.g., /filename_sym): Images created under the Batch menu are put in the original folder and the image names are given a suffix 5.2.4 Texture Averages This applies a representative texture to the average, resulting in composite images with more realistic texture instead of the very smooth, bland texture most other averaging programs create. See the papers below for methodological details. B. Tiddeman, M. Stirrat and D. Perrett (2005). Towards realism in facial prototyping: results of a wavelet MRF method. Theory and Practice of Computer Graphics. B. Tiddeman, D.M. Burt and D. Perrett (2001). Computer Graphics in Facial Perception Research. IEEE Computer Graphics and Applications, 21(5), 42-50. 5.2.5 Sample Contours This interpolates more control points along the lines. This can improve the accuracy of averages and transforms. If you see a “feathery” appearance along lines that have many, close-together points, try turning this off. 5.2.6 Normalisation None: averages will have all coordinates as the exact mathematical average of the coordinates in the component templates 2-point: all images are first aligned to the 2 alignment points designated in the Default alignment preference. Their position is set to their position in the first image in the average Rigid-body: procrustes aligns all images to the position of the first image in the average list 5.2.7 Warp Types Multiscale: Implements multi-scale affine interpolation for image warping. This is the default, with a good balance between speed and accuracy Linear: Implements triangulated linear interpolation for image warping. Linear warping is least accurate, often resulting in image artifacts, but is very fast. Multiscale RB: Implements multi-scale rigid body interpolation for image warping. This decreases image artifacts in some circumstances, but is much slower. 5.2.8 Mask Color This is the default color for masking, cropping, and rotation. Don’t worry, you can always change it in the batch mask, crop and rotate dialogs. 5.3 Templates 5.3.1 Default Template This is the template that is used when you fit a new template to an image that doesn’t have a template yet. WebMorph comes with several templates and defaults to the 189-point FRL-Face template for forward-facing faces. You can also define your own templates. 5.3.2 Default Alignment Set the parameters to use for batch alignment and 2-point normalisation.You can override this in the Batch Align dialog. Typically, the two points are the left and right eye points. You also need to specify an image size. Images normalised with these setting will be rotated and resized such that the two points are in the specified place, and the image will be cropped to the specified size. The default settings for the FRL-Face template are x = 496.98 and y = 825.688 for the left eye point (0) and x = 853.02 and y = 825.688 for the right eye point (1). I know this is weird, but it was taken from a composite image that the Face Research Lab used for years to standardise all images, since the only way you can do this in PsychoMorph is using an existing template. 5.3.3 Delineation Apprearance Change the colours of the unselected and selected delineation crosses, and the lines, as well as the thickness of the lines. This can be useful if you’re delineating images with very dark or light colours. "],["keyboard-shortcuts.html", "A Keyboard Shortcuts A.1 Command A.2 Shift-Command", " A Keyboard Shortcuts This list is not yet complete. A.1 Command 0: Zoom to original size (Delineate window) 2: Show Finder window 3: Show Delineate window 4: Show 3D window 5: Show Average window 6: Show Transform window 7: Show Projects window A: Select all (files in Finder, points in Delineate window) C: Copy files D: Download selected files F: Find files in open Finder L: Get file list for selected files I: Get info for selected files (BUG) M: Fit image to Delineate window R: Refresh the interface S: Save template in Delineate window T: Toggle template visibility in Delineate window (BUG) U: Upload files V: Paste copied files W: Close pop-up dialogs X: Cut selected files Z: Undo (only for delineation) +: Zoom in -: Zoom out ,: Open Preferences delete: Delete selected file or folders (Finder) or template points (Delineate window) A.2 Shift-Command N: New Project (in Project Window) or new folder (in Finder) U: Upload from webcamera delete: Delete files or folders without a confrimation dialog "],["news.html", "B News", " B News (2021-02-25) Manual There is now a manual! It’s very much under construction, but will become more complete with time. (2021-02-25) Directory Deletion You can now delete folders and all of their contents in one step. Just select a single folder and cmd-delete. The full folder will go into the Trash and you can move it out by dragging. I tried to build in as many checks as possible to make sure you can’t accidentally delete things you don’t mean to, but file a bug report immediately if there are any unintended consequences. (2021-02-24) Built-in Image Sets You can now load a few built-in image sets under the File menu. (2018-2021) Stuff I did a lot of work on WebMorph in these years, especially the 3D functions, but did a poor job of documenting it. (2018-05-11) Create TPS Files You can now create a TPS file for selected images and templates by selecting them and choosing Create TPS File from the Template menu. (2018-04-26) Automatic Delineation I’ve switched the automatic delineation to Face++. You can batch auto-delineate all selected images in the Finder window or auto-delineate single images in the Delineation window. (2018-02-25) Image Grids Image grids (under the Tools menu) had stopped working. They’re now fixed. (2018-02-15) Batch Function bug fixed There was a bug that deleted the first line of batch transforms and batch edits. It’s fixed. (2018-02-04) Masked Scrambles You can now scramble inside of a mask, rathe than choosing set squares to scramble. Choose a mask style or set the mask colour from the top left corner of the image. (2018-02-01) Masking Colour from Image Patch In the batch align, rotate, crop and mask functions, you can now specify the masking colour from an image patch by defining the coordinates of the top left and bottom right corners of the path. For example, if you want to match the median colour of the top 10 rows of pixels, set the patch coordinates to 0, 0 and 2000, 10 (if you set the coordinates outside the range of the image size, it will default to the width of the image). (2018-01-29) Batch Functions I’ve made several updates to batch functions so they are easier to use. You can now also upload your batch files as tab-delimited .txt files and load them by double-clicking them in the finder. (2017-06-19) Dragging Finder Files I’ve reinstated drag and drop, but will probably refine this in the future to get webmorph to work better with touch screens. (2017-06-19) Various Bug Fixes Fit points move with the image if you zoom during 3-point delineation. Tem files are updated in the finder when you save a new delineation. The refresh button has been moved away from the save button on the delineation page to prevent accidental refreshes. Checkboxes were not showing as checked in Firefox on Windows. I think they’re fixed now. 3-point delineation can now be undone/redone. (2017-03-10) Dragging Finder Files Dragging files in the finder to move them between folders was causing too many glitches, especially with touch screens, so I’ve removed this function. You can still move files between folders by selecting them, copying (C) or cutting (X) under the Edit menu, and pasting (V) into the new folder. In the Average and Transform windows, double-click on the image boxes to load selected images. (2017-02-27) 3D Images WebMorph now has limited support for 3D faces. You can upload OBJ files and associated BMP or JPEG textures and view them in the delineator. You can also morph between two objects that have the same geometry. I will add further functions soon. New projects contain example OBJs if you want to have a play. (2017-02-14) Masking Transparency and Blur Transparency has been fixed in the masks and blur works better now. Transparency with blur still looks a bit odd, so I would keep blur to 0 or 1 on images with transparency. As always, masks are smoother on bigger images, but take longer. (2017-02-13) Reverse Masking There is now a checkbox in the batch masking interface to specify a reverse mask. (2017-02-13) Scrambling I fixed some glitches in the scrambling interface. You can now make very fine grid scrambles and the offset works correctly. You can also create symmetric scrambles, where the scramble order on the left side of the image mirrors the scramble order on the right side of the image. (2017-02-12) Keyboard Shortcuts I had to remove several keyboard shortcuts because they were incompatible with some web browsers. I also removed most of the keyboard shortcuts for batch functions. Do let me know if you have an idea for a useful new keyboard shortcut. (2017-02-12) Batch Transforms Batch transforms now handle comma-separated lists and relative file names. Percent symbols (%) are now optional in the shape, color, and texture columns. (2017-02-12) File history File histories are now saved and displayed in a way that is easier to read and replicate. (2017-01-10) URL Hash Added methods to keep selected files and folders in the Finder window between page reloads. (2017-01-06) Fixed Template Editing Some of the template editing functions were broken because of other changes. These should be fixed now. (2016-09-06) Template Visualization You can now visualize templates and save them as PNG files with the Visualize Template (D) command under the Batch menu.. (2016-08-22) Project size listing I updated how the project sizes load so that initial loading of the project list is faster. (2016-08-17) Delete Projects You can now delete projects if you are the owner. Please be careful; it is not easy to undelete projects. (2016-07-14) Light Table You can turn on the Light Table under the View menu to compare images dragged onto the Light Table. Double-click on images to remove them. (2016-06-11) Touch Compatibility WebMorph is now more compatible with touch devices. Let me know if there is anything you can’t do on a touch device. (2016-06-11) Batch Edit There is a new Batch function called Batch Edit (E). You can align, resize, rotate, crop, mask, symmetrise and/or mirror images in a single step from a batch script. I’ve also provided demo scripts for batch edit, batch average, and batch transform. Just download them and open them in Excel. (2016-06-11) Finder Loading The finder shouldn’t reload all of the time and should load images from the queue as they are made. There are definitely a few bugs, so just refresh (R) the finder if your file structure doesn’t look right. (2016-04-20) Read-Only Project Members Projects can now have read-only members. Click on the A or R next to a project member’s name to toggle their access permission. I have not yet thoroughly checked that read-only members cannot make any destructive project changes, so please be careful and only add project members you trust. (2016-04-20) Template Conversions Template conversions can now handle templates without images. We also added a new template: the 129-point template from Scott et al. PLoS One for use in Geometric MorphoMetric analyses. I also fixed some bugs with the new file namer for batch functions. (2016-04-14) Scrambles Check out the new batch scrambling function! (2016-04-14) Downloadable Delineation Images If you right-click on a delineation in the Delineation window, you can now see a contextual menu to download SVG files of the delineation (all, lines only, points only, or numbered points). Open this file in a text editor to see how easily you can change the line and points colours and widths. Drag the file into a web browser to view it. (2016-04-13) Messages Now development messages are only shown once per account, so you don’t have to close them every time you reload the page. I’ve also made a lot of small changes to tidy up the code. Let me know if it breaks anything. (2016-04-08) Multiple Directory Functions You can now select folders and apply batch functions (and deletion) to several folders at once. You can also bypass the confirmation dialog when deleting files and folders by using ⌫ or -backspace. This is likely to be a little buggy at first, so make sure you back up your important files regularly (which you should already be doing). (2016-04-06) Continuum and Grid I fixed several bugs in the continuum and grid transforms. I also added a new batch function for multiple continua (e.g., morph from A to B to C to D…). Watch out, it might still be a bit buggy. (2016-04-04) Account Registration Account registration is now done automatically through the website and account requests are put on a wait list. (2016-03-21) Project Size Project sizes are now only calculated once at the beginning of a session and after changes are made to the project. This prevents long delays when switching between the project window and other windows. (2015-11-15) Making Averages You can now drag files to the average face in the Average Window to add them to an average. This is useful if you want to average images from more than one folder. You can also include the same image more than once. The first image in the list provides the height and width for the average image and also the coordinates for 2-point or rigid-body alignment. (2015-11-10) Projects Your files are now organised into shareable projects. For now: All group members can add and delete both members and files. Any WebMorph user can be added to a project by their email or name. The original owner cannot be removed from the project. The original owner is the only person who can delete a project. All files in a project count towards the project owner’s space allocation. Contact Lisa to change your space allocation. If you are over your space allocation, you will not be able to save or upload files until you delete things (and empty your trash). I am planning to add permissions for project members so you can have read-only members, but that might take some time, so make sure you trust the people you add to a project. As always, please back up important projects by downloading and saving the files. (2015-10-17) Changes to file deletion Deleted files are now moved to a Trash folder that is viewable through the View menu. The ability to empty the trash folder will be added soon. (2015-10-02) Changes to the delineation interface The Kinetic library had been causing many crashes, so I’ve removed that and now the delineations are done somewhat differently. This won’t cause much difference for most users, apart from some cosmetic changes in cross and line highlighting. For now, deleting lines is no longer possible (although you can still undo them if you’re creating a new template). (2015-01-06) Changes to averaging and transforming The functions that average and transform images have been re-written. For the most part, you won’t notice any difference. Estimated processing times for manual (not batch) averages and transforms are given in the footer now. These will become more accurate as I collect more data. You can now create larger averages (bigger image size and/or more images per average). As I collect more data, I will add a function to warn you if averages are likely to fail. Fixed a bug that prevented queue items from being cleared, paused, or restarted. (2014-11-21) Decreased initial loading time I’ve put in place a temporary fix to help accounts with &gt;1000 images that have been experiencing very slow loading times and warnings about unresponsive scripts. The initial loading time is now 1-5 seconds to get your image list from the server (this depends on current server load) and an additional ~1 second per 2000 images to display them. The side effects of these changes are that: Column width in the finder window is no longer flexible and sized to the contents, but fixed at 200 pixels. (changed back 2015-01-06) The average and transform windows no longer only show images that have a tem file. If you choose an image that has no tem, you won’t get a warning message, but your average will not include that image. If you try to transform using an image with no tem file, the transform will fail and you will get a blank error window. I’ll fix this so you get appropriate warnings as soon as possible, but I am very busy until mid-December. (2014-07-21) Delineation Improvements Use + and - to increase or decrease the size of a selected group of delineation points. (2014-06-15) Queue Batch transformations are now placed in a queue, where they can complete in the background and be paused and restarted. [2014-11-21: Pausing seems to be broken. This is on my to-do list.] (2014-05-22) Template changes and menu reorganisation I’m reorganising the menu items, so their location and shortcuts will be changing a bit over the next few weeks. I’m also trying to make it easier to manage multiple template styles. (2014-05-07) Major upgrade Most of the changes are behind the scenes to improve security and stability. Secure image storage so your images are not accessible by anyone except you when you are logged into your account More secure password storage Upload and save images as JPG, PNG or GIF. (PNGs lose transparency when transformed) Better batch functions for renaming, aligning, cropping, resizing, masking, symmetrising, mirroring, modifying delineations, and calculating facialmetrics You can save your own facialmetric equations Better support for multiple delineation types (2013-11-17) Major interface change The array of images in the Average and Transform windows have been replaced by the Finder. This required a major change to almost all functions, so please let me know when you find remaining bugs. You can now save new averages and transforms by dragging them into the Finder. (2013-11-12) Webcam Upload From any folder in the finder, select File &gt; Webcam Upload (W) to use your webcam to take a picture, name it and save it. (2013-11-10) Batch rename Select files in the finder and select Actions &gt; Batch Rename (N) to add a prefix, suffix, index, and multiple search and replace. (2013-11-01) Drag and drop file moving Try dragging selected files (as many as you want) or folders (one folder at a time for now) into another folder "],["references.html", "C References", " C References Conway, CA, BC Jones, LM DeBruine, AC Little, and A Sahraie. 2008. “Transient Pupil Constrictions to Faces Are Sensitive to Orientation and Species.” Journal of Vision 8. https://doi.org/10.1167/8.3.17. DeBruine, Lisa. 2016. “Young Adult Composite Faces.” figshare. https://doi.org/10.6084/m9.figshare.4055130.v1. ———. 2018. Webmorph: Beta Release 2 (version v0.0.0.9001). Zenodo. https://doi.org/10.5281/zenodo.1162670. DeBruine, Lisa, and Benedict Jones. 2017. “Face Research Lab London Set.” figshare. https://doi.org/10.6084/m9.figshare.5047666.v3. Lefevre, Carmen E, Gary J Lewis, David I Perrett, and Lars Penke. 2013. “Telling Facial Metrics: Facial Width Is Associated with Testosterone Levels in Men.” Evolution and Human Behavior 34 (4): 273–79. "]]
